
<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boligkostkalkulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .chart-container {
            margin-top: 30px;
        }
        .bar {
            fill: steelblue;
        }
        .bar:hover {
            fill: #7db9e8;
        }
        .axis-label {
            font-size: 14px;
            font-weight: bold;
        }
        .threshold-line {
            stroke: red;
            stroke-dasharray: 5,5;
            stroke-width: 2;
        }
        .bar-value {
            font-size: 12px;
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <h1>Boligkostkalkulator</h1>
    
    <div class="form-container">
        <div>
            <div class="form-group">
                <label for="address">Adresse:</label>
                <input type="text" id="address" value="Øysteins gate 4">
            </div>
            <div class="form-group">
                <label for="price">Pris (kr):</label>
                <input type="number" id="price" value="2990000">
            </div>
            <div class="form-group">
                <label for="communal">Kommunale avgifter per år (kr):</label>
                <input type="number" id="communal" value="7242">
            </div>
        </div>
        <div>
            <div class="form-group">
                <label for="shared">Felleskostnader per måned (kr):</label>
                <input type="number" id="shared" value="2000">
            </div>
            <div class="form-group">
                <label for="propertyTax">Eiendomsskatt per år (kr):</label>
                <input type="number" id="propertyTax" value="2437">
            </div>
            <div class="form-group">
                <label for="equity">Egenkapital (kr):</label>
                <input type="number" id="equity" value="1500000">
            </div>
            <div class="form-group">
                <label for="threshold">Månedlig budsjettgrense (kr):</label>
                <input type="number" id="threshold" value="14000">
            </div>
            <div class="form-group">
                <label for="interestRate">Årlig rente (%):</label>
                <input type="number" id="interestRate" value="5.5" step="0.1">
            </div>
        </div>
    </div>
    
    <button id="calculate">Generer graf</button>
    
    <div class="chart-container">
        <div id="chart"></div>
    </div>
    
    <script>
        document.getElementById('calculate').addEventListener('click', generateGraph);
        
        // Initial graph on page load
        generateGraph();
        
        function calculateMonthlyCost(price, communalFee, sharedCost, propertyTax, equity, interestRate) {
            const loan = price - equity;
            const monthlyInterestRate = interestRate / 100 / 12;
            const n = 30 * 12; // 360 months (30 years)
            
            const monthlyPayment = loan * monthlyInterestRate * Math.pow(1 + monthlyInterestRate, n) / 
                                 (Math.pow(1 + monthlyInterestRate, n) - 1);
            
            const monthlyCommunalFee = communalFee / 12;
            const monthlyPropertyTax = propertyTax / 12;
            
            return monthlyPayment + monthlyCommunalFee + sharedCost + monthlyPropertyTax;
        }
        
        function formatNumber(num) {
            return new Intl.NumberFormat('no-NO').format(Math.round(num));
        }
        
        function generateGraph() {
            // Get input values
            const address = document.getElementById('address').value;
            const price = Number(document.getElementById('price').value);
            const communalFee = Number(document.getElementById('communal').value);
            const sharedCost = Number(document.getElementById('shared').value);
            const propertyTax = Number(document.getElementById('propertyTax').value);
            const equity = Number(document.getElementById('equity').value);
            const threshold = Number(document.getElementById('threshold').value);
            const interestRate = Number(document.getElementById('interestRate').value);
            
            // Generate price range
            const priceRange = [];
            const costRange = [];
            
            for (let p = price - 200000; p <= price + 900000; p += 100000) {
                priceRange.push(p);
                costRange.push(calculateMonthlyCost(p, communalFee, sharedCost, propertyTax, equity, interestRate));
            }
            
            // Clear previous chart
            d3.select("#chart").html("");
            
            // Set dimensions and margins
            const margin = {top: 50, right: 30, bottom: 90, left: 100};
            const width = 900 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;
            
            // Create SVG
            const svg = d3.select("#chart")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);
            
            // X axis
            const x = d3.scaleBand()
                .range([0, width])
                .domain(priceRange.map(d => d))
                .padding(0.2);
            
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickFormat(d => formatNumber(d)))
                .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("dx", "-.8em")
                    .attr("dy", ".15em")
                    .attr("transform", "rotate(-45)");
            
            // Add X axis label
            svg.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "middle")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom - 10)
                .text("Kjøpepris (kr)");
            
            // Y axis
            const maxCost = Math.max(...costRange) + 2000;
            const y = d3.scaleLinear()
                .domain([0, maxCost])
                .range([height, 0]);
            
            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(d => formatNumber(d)));
            
            // Add Y axis label
            svg.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -margin.left + 30)
                .text("Totale kostnader per måned (kr)");
            
            // Add title
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", -margin.top / 2)
                .attr("text-anchor", "middle")
                .style("font-size", "18px")
                .style("font-weight", "bold")
                .text(address);
            
            // Add threshold line
            svg.append("line")
                .attr("class", "threshold-line")
                .attr("x1", 0)
                .attr("x2", width)
                .attr("y1", y(threshold))
                .attr("y2", y(threshold));
            
            // Add bars
            svg.selectAll(".bar")
                .data(costRange)
                .enter()
                .append("rect")
                    .attr("class", "bar")
                    .attr("x", (d, i) => x(priceRange[i]))
                    .attr("y", d => y(d))
                    .attr("width", x.bandwidth())
                    .attr("height", d => height - y(d));
            
            // Add value labels on top of bars
            svg.selectAll(".bar-value")
                .data(costRange)
                .enter()
                .append("text")
                    .attr("class", "bar-value")
                    .attr("x", (d, i) => x(priceRange[i]) + x.bandwidth() / 2)
                    .attr("y", d => y(d) - 10)
                    .text(d => formatNumber(d));
        }
    </script>
</body>
</html>